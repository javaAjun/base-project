<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>layui</title>
  <meta name="renderer" content="webkit">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <link rel="stylesheet" href="../plugins/layui/css/layui.css"  media="all">
  
  <!-- 注意：如果你直接复制所有代码到本地，上述css路径需要改成你本地的 -->
</head>
<body>
          

              
<fieldset class="layui-elem-field layui-field-title" style="margin-top: 20px;">
  <legend>新增菜单</legend>
</fieldset>
 

 
<form class="layui-form" action="" lay-filter="example">
  <div class="layui-form-item">
    <label class="layui-form-label">菜单名称</label>
    <div class="layui-input-block">
      <input type="hidden" name="id" lay-verify="title"  class="layui-input">
      <input type="text" name="menuName" lay-verify="title" autocomplete="off" placeholder="请输入标题" class="layui-input">
    </div>
  </div>
  <div class="layui-form-item">
    <label class="layui-form-label">菜单链接</label>
    <div class="layui-input-block">
      <input type="text" name="url" placeholder="请输入密码" autocomplete="off" class="layui-input">
    </div>
  </div>
  <div class="layui-form-item">
    <label class="layui-form-label">菜单排序</label>
    <div class="layui-input-block">
      <input type="text" name="sequenceNumber" placeholder="请输入密码" autocomplete="off" class="layui-input">
    </div>
  </div>
  <div class="layui-form-item">
    <label class="layui-form-label">上级菜单</label>
    <div class="layui-input-block">
      <select  name="parentId" lay-filter="aihao">
        <option  value="0">顶级菜单</option>
      </select>
    </div>
  </div>
  
  <div class="layui-form-item">
    <label class="layui-form-label">隐藏状态</label>
    <div class="layui-input-block">
      <input type="radio" name="isDisplay" value="1" title="隐藏">
      <input type="radio" name="isDisplay" value="0" title="不隐藏" checked="">
    </div>
  </div>
  <div class="layui-form-item">
    <label class="layui-form-label">是否有效</label>
    <div class="layui-input-block">
      <input type="radio" name="idEffective" value="1" title="无效">
      <input type="radio" name="idEffective" value="0" title="有效" checked="">
    </div>
  </div>
  
  <!-- <div class="layui-form-item">
    <label class="layui-form-label">单选框</label>
    <div class="layui-input-block">
      <input type="radio" name="sex" value="男" title="男" checked="">
      <input type="radio" name="sex" value="女" title="女">
    </div>
  </div> -->
  <div class="layui-form-item layui-form-text">
    <label class="layui-form-label">菜单描述</label>
    <div class="layui-input-block">
      <textarea placeholder="请输入内容" class="layui-textarea" name="menuInfo"></textarea>
    </div>
  </div>
 
  <div class="layui-form-item">
    <div class="layui-input-block">
      <button class="layui-btn" lay-submit="" lay-filter="demo1">立即提交</button>
      <button class="layui-btn layui-btn-primary" id="addCancel">取消</button>
    </div>
  </div>
</form>

          
<script src="../js/js.js" charset="utf-8"></script>
<script src="../js/jquery-1.10.1.min.js" charset="utf-8"></script>
<script src="../plugins/layui/layui.js" charset="utf-8"></script>
<script src="../js/showAlert.js" charset="utf-8"></script>

<!-- 注意：如果你直接复制所有代码到本地，上述js路径需要改成你本地的 -->
<script>
layui.use(['form', 'layedit', 'laydate'], function(){
  var form = layui.form
  ,layer = layui.layer
  ,layedit = layui.layedit
  ,laydate = layui.laydate;  
  //创建一个编辑器
  var editIndex = layedit.build('LAY_demo_editor');
 
  //自定义验证规则
  form.verify({
    title: function(value){
      if(value.length < 0){
        return '菜单名称不能为空';
      }
    }
    ,pass: [/(.+){6,12}$/, '密码必须6到12位']
    ,content: function(value){
      layedit.sync(editIndex);
    }
  });
  
  
  //监听提交
  form.on('submit(demo1)', function(data){
    /* layer.alert(JSON.stringify(data.field), {
      title: '最终的提交信息'
    }) */
    console.log(data);
    $.ajax({
          url: ctx+"/baseMenu/addMenu",
          data: data.field,
          type: "POST",
          dataType: "json",
          success: function (data) {
          	if(data.code=="1"){
           	showMsg(data.info,function(){
           		history.back(-1);
           	});
          	}else{
          		showMsg(data.info);
          	}
          },
          error: function (data) {
              try {
                  layer.msg("请求异常");
                  return false;
              } catch (e) {
                  console.log(e);
              }
          }
      });
    return false;
  }); 
  
});
$("#addCancel").click(function(){
	history.back(-1);
})
$(function(){
	var id;
    var url = window.location.search; 
	var menuId = url.substring(url.lastIndexOf('=')+1, url.length);
	if(menuId!=''){
		id=menuId;
	}
	$.ajax({
        url: ctx+"/baseMenu/menuInfo",
        data: {"menuId":id},
        type: "POST",
        dataType: "json",
        success: function (data) {
	       	$("input[name='id']").val(data.id);
	       	$("input[name='menuName']").val(data.menuName);
	       	$("input[name='sequenceNumber']").val(data.sequenceNumber);
	       	$("input[name='url']").val(data.url);
	       	$("input[name='menuInfo']").val(data.menuInfo);
	       	$("textarea[name='menuInfo']").val(data.menuInfo);
        	if(data.isDisplay=='1'){
        		//$("input[name='isDisplay']").eq(0).removeAttr("checked");
        		$("input[name='isDisplay']").eq(0).attr("checked","checked");
        	}else{
        		//$("input[name='isDisplay']").eq(1).removeAttr("checked");
        		$("input[name='isDisplay']").eq(1).attr("checked","checked");
        	}
        	if(data.idEffective=='1'){
        		//$("input[name='idEffective']").eq(0).removeAttr("checked");
        		$("input[name='idEffective']").eq(0).attr("checked","checked");
        	}else{
        		//$("input[name='idEffective']").eq(1).removeAttr("checked");
        		$("input[name='idEffective']").eq(1).attr("checked","checked");
        	}
        	layui.use('form', function() {
                var form = layui.form; //只有执行了这一步，部分表单元素才会自动修饰成功
                form.render();
            });
        	console.log($("input[name='idEffective']").val());
        },
        error: function (data) {
            try {
                layer.msg("请求异常");
                return false;
            } catch (e) {
                console.log(e);
            }
        }
    });
	
	
	$.ajax({
        url: ctx+"/baseMenu/getAllList",
        type: "POST",
        dataType: "json",
        success: function (data) {
        	console.log(data);
        	layui.use('form', function() {
                var form = layui.form; //只有执行了这一步，部分表单元素才会自动修饰成功
                form.render();
            });
        },
        error: function (data) {
            try {
                layer.msg("请求异常");
                return false;
            } catch (e) {
                console.log(e);
            }
        }
    })
})
</script>

</body>
</html>